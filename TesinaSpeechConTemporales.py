terminals_video = {
    'ojos': ' ',
    'nariz': ' ',
    'boca': ' ',
    'oreja': ' ',
    'frente': ' ',
    'cabeza': ' ',
    'ceja': ' ',
    'hombro': ' ',
    'brazo': ' ',
    'dedos': ' ',
    'manos': ' ',
    'pecho': ' ',
    'abdomen': ' ',
    'pies': ' ',
    'cerebro': ' ',
    'lengua': ' ',
    'corazon': ' ',
    'pulmones': ' ',
    'higado': ' ',
    'riñones': ' ',
    'intestino': ' ',
    'apendice': ' ',
    'vagina': ' ',
    'ovarios': ' ',
    'pene': ' ',
    'testiculos': ' ',
    'alto': ' ',
    'chaparro': ' ',
    'gordo': ' ',
    'flaco': ' ',
    'guapo': ' ',
    'feo': ' ',
    'rubio': ' ',
    'pelirojo': ' ',
    'pecoso': ' ',
    'piel blanca': ' ',
    'barba': ' ',
    'bigote': ' ',
    'fuerte': ' ',
    'debil': ' ',
    'moreno': ' ',
    'azul': ' ',
    'amarillo': ' ',
    'cafe': ' ',
    'gris': ' ',
    'negro': ' ',
    'naranja': ' ',
    'rojo': ' ',
    'morado': ' ',
    'verde': ' ',
    'rosa': ' ',
    'oscuro': ' ',
    'claro': ' ',
    'color': ' ',
    'grande': ' ',
    'pequeño': ' ',
    'alto': ' ',
    'bajo': ' ',
    'sobre de': ' ',
    'bajo de': ' ',
    'adentro': ' ',
    'enfrente': ' ',
    'atras': ' ',
    'esferico': ' ',
    'plano': ' ',
    'fino': ' ',
    'suave': ' ',
    'aspero': ' ',
    'afuera': ' ',
    'yo': ' ',
    'tu': ' ',
    'el': ' ',
    'ella': ' ',
    'ellos': ' ',
    'ellas': ' ',
    'nosotros': ' ',
    'ustedes': ' ',
    'mio': ' ',
    'tuyo': ' ',
    'suyo': ' ',
    'de ella': ' ',
    'de ellos': ' ',
    'de ellas': ' ',
    'nuestro': ' ',
    'de ustedes': ' ',
    'carro': ' ',
    'pelota': ' ',
    'telefono': ' ',
    'dinero': ' ',
    'ropa': ' ',
    'juguete': ' ',
    'plato': ' ',
    'estufa': ' ',
    'bicicleta': ' ',
    'jabon': ' ',
    'sacapuntas': ' ',
    'llave': ' ',
    'espejo': ' ',
    'computadora': ' ',
    'papel': ' ',
    'zapato': ' ',
    'mesa': ' ',
    'silla': ' ',
    'sombrero': ' ',
    'teni': ' ',
    'puerta': ' ',
    'calceta': ' ',
    'cuaderno': ' ',
    'lapiz': ' ',
    'toalla': ' ',
    'vaso': ' ',
    'pluma': ' ',
    'parque': ' ',
    'cine': ' ',
    'escuela': ' ',
    'biblioteca': ' ',
    'oficina': ' ',
    'casa': ' ',
    'baño': ' ',
    'salon': ' ',
    'calle': ' ',
    'laguna': ' ',
    'presa': ' ',
    'mar': ' ',
    'alberca': ' ',
    'campo': ' ',
    'fabrica': ' ',
    'restaurante': ' ',
    'tienda': ' ',
    'museo': ' ',
    'iglesia': ' ',
    'hospital': ' ',
    'centro': ' ',
    'maestro': ' ',
    'mesero': ' ',
    'arquitecto': ' ',
    'doctor': ' ',
    'ingeniero': ' ',
    'abogado': ' ',
    'psicologo': ' ',
    'empresario': ' ',
    'policia': ' ',
    'soldador': ' ',
    'enfermero': ' ',
    'carpintero': ' ',
    'ayer': ' ',
    'hoy': ' ',
    'mañana': ' ',
    'antier': ' ',
    'futuro': ' ',
    'pasado': ' ',
    'presente': ' ',
    'ahorita': ' ',
    'ya': ' ',
    'acaba de pasar': ' ',
    'antiguo': ' ',
    'horario': ' ',
    'proximo': ' ',
    'temprano': ' ',
    'en la mañana ': ' ',
    'tarde': ' ',
    'noche': ' ',
    'nuevo': ' ',
    'viejo': ' ',
    'tiempo': ' ',
    'hombre ': ' ',
    'mujer': ' ',
    'sobrino': ' ',
    'suegro': ' ',
    'compadre': ' ',
    'ahijado': ' ',
    'abuelo': ' ',
    'hijo': ' ',
    'primo': ' ',
    'nuera': ' ',
    'comadre': ' ',
    'novio': ' ',
    'papá': ' ',
    'nieto': ' ',
    'hermano': ' ',
    'yerno': ' ',
    'padrino': ' ',
    'padrastro': ' ',
    'mamá': ' ',
    'tio': ' ',
    'cuñado': ' ',
    'madrina': ' ',
    'madrastra': ' ',
    'esposo': ' ',
    'viudo': ' ',
    'amante': ' ',
    'soltero': ' ',
    'casado': ' ',
    'separado': ' ',
    'ejercicio': ' ',
    'trabajar': ' ',
    'dormir': ' ',
    'comer': ' ',
    'bailar': ' ',
    'estudiar': ' ',
    'visitar': ' ',
    'caminar': ' ',
    'correr': ' ',
    'saltar': ' ',
    'dibujar': ' ',
    'escribir': ' ',
    'leer': ' ',
    'criticar': ' ',
    'bañar': ' ',
    'pelear': ' ',
    'discutir': ' ',
    'dialogar': ' ',
    'ordenar': ' ',
    'hacer': ' ',
    'cocinar': ' ',
    'beber': ' ',
    'jugar': ' ',
    'ver': ' ',
    'llamar': ' ',
    'robar': ' ',
    'esconder': ' ',
    'comprar': ' ',
    'lavar': ' ',
    'limpiar': ' ',
    'poner': ' ',
    'quitar': ' ',
    'cambiar': ' ',
    'avisar': ' ',
    'ganar': ' ',
    'perder': ' ',
    'esperar': ' ',
    'ir': ' ',
    'preparar': ' ',
    'tirar': ' ',
    'salvar': ' ',
    'escapar': ' ',
    'semana': ' ',
    'lunes': ' ',
    'martes': ' ',
    'miercoles': ' ',
    'jueves': ' ',
    'viernes': ' ',
    'sabado': ' ',
    'domingo': ' ',
    'mes': ' ',
    'enero': ' ',
    'febrero': ' ',
    'marzo': ' ',
    'abril': ' ',
    'mayo': ' ',
    'julio': ' ',
    'agosto': ' ',
    'septiembre': ' ',
    'octubre': ' ',
    'noviembre': ' ',
    'diciembre': ' ',
    'junio': ' ',
    'segundo': ' ',
    'minuto': ' ',
    'hora': ' ',
    'dia': ' ',
    'año': ' ',
    'decada': ' ',
    'siglo': ' ',
    'instantaneo': ' '
}



import nltk
import speech_recognition as sr

nltk.download('punkt')
from nltk.tree import Tree

MY_GRAMMAR = """
    S -> VP | VP NP | NP VP | NP V
    NP -> DET N | ADJ NP | N | PRON | NP PP
    VP -> V NP | V NP PP | VP ADV | ADJ VP
    PP -> P NP
    ADJ -> 'grande' | 'pequeño' | 'alto' | 'bajo' | 'suave' | 'fino' | 'áspero' | 'azul' | 'amarillo' | 'café' | 'gris' | 'negro' | 'naranja' | 'rojo' | 'morado' | 'verde' | 'rosa' | 'oscuro' | 'claro'
    DET -> 'el' | 'la' | 'los' | 'las' | 'su'
    N -> 'perro' | 'gato' | 'casa' | 'coche' | 'comida' | 'niño' | 'hombre' | 'mujer' | 'cosa' | 'pelo' | 'ojos' | 'nariz' | 'boca' | 'oreja' | 'frente' | 'cabeza' | 'ceja' | 'brazo' | 'dedos' | 'manos' | 'pecho' | 'abdomen' | 'pies' | 'cerebro' | 'lengua' | 'corazón' | 'pulmones' | 'hígado' | 'riñones' | 'intestinos' | 'apéndice' | 'vagina' | 'ovarios' | 'pene' | 'testículos' | 'barba' | 'bigote'
    V -> 'come' | 'corre' | 'duerme' | 'conduce' | 'ama' | 'canta' | 'baila' | 'habla' | 'es'
    P -> 'a' | 'de' | 'en' | 'con' | 'por'
    ADV -> 'bien' | 'mal' | 'rápido' | 'lentamente' | 'siempre' | 'nunca' | 'ayer' | 'hoy' | 'mañana' | 'antier' | 'futuro' | 'pasado' | 'ahorita' | 'ya' | 'acaba de pasar' | 'antiguo' | 'horario' | 'próximo' | 'en la mañana' | 'tarde' | 'noche' | 'nuevo' | 'viejo' | 'tiempo'
    PRON -> 'yo' | 'tú' | 'él' | 'ella' | 'nosotros' | 'ellos' | 'ustedes' | 'mío' | 'tuyo' | 'suyo' | 'de ella' | 'de ellos' | 'nuestro' | 'de ustedes'
"""

grammar = nltk.CFG.fromstring(MY_GRAMMAR)
parser = nltk.ChartParser(grammar)
terminals = set(rule.rhs()[0] for rule in grammar.productions() if len(rule.rhs()) == 1 and isinstance(rule.rhs()[0], str))

def modify_sentence(oracion):
    tokens = nltk.word_tokenize(oracion.lower(), language='spanish')
    unacceptable_tokens = [token for token in tokens if token not in terminals]
    filtered_tokens = [token for token in tokens if token in terminals]
    print(unacceptable_tokens)
    print(filtered_tokens)
    trees = list(parser.parse(filtered_tokens))
    if not trees:

        return None
    tree = trees[0]
    new_tokens = []
    for subtree in tree.subtrees():
        if subtree.label() == 'DET':
            continue
        elif subtree.label() == 'N':
            new_tokens.append(subtree.leaves()[0])
        elif subtree.label() == 'V':
            new_tokens.append(subtree.leaves()[0])
        elif subtree.label() == 'ADV' and subtree.leaves()[0] in ['ayer', 'hoy', 'mañana', 'antier', 'futuro', 'pasado', 'ahorita', 'ya', 'acaba', 'de', 'pasar', 'antiguo', 'horario', 'próximo', 'en', 'la', 'mañana', 'tarde', 'noche', 'nuevo', 'viejo', 'tiempo']:
            new_tokens.append(subtree.leaves()[0])
    print("Los tokens no aceptados de la frase fueron: " , unacceptable_tokens)
    return ' '.join(new_tokens)

def listen_and_process():
    r = sr.Recognizer()
    with sr.Microphone() as source:
        print("Diga algo:")
        audio = r.listen(source)
    try:
        print("Google Speech Recognition cree que has dicho: " + r.recognize_google(audio, language='es-ES'))
        modified_sentence = modify_sentence(r.recognize_google(audio, language='es-ES'))
        if modified_sentence:
            print("La oración modificada es:", modified_sentence)
        else:
            print("No se pudo modificar la oración.")
    except sr.UnknownValueError:
        print("Google Speech Recognition no pudo entender el audio.")
    except sr.RequestError as e:
        print("No se puede acceder al servicio de reconocimiento de voz de Google Speech Recognition; {0}".format(e))

listen_and_process()